(function(c){c.fn.extend({tableExport:function(a){function q(a,c,d){var k="";c=h(a,c,d);a=null===c||""==c?"":c.toString();if(c instanceof Date)k=b.csvEnclosure+c.toLocaleString()+b.csvEnclosure;else if(c=b.csvEnclosure+b.csvEnclosure,k=a.replace(new RegExp(b.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),c),0<=k.indexOf(b.csvSeparator)||/[\r\n ]/g.test(k))k=b.csvEnclosure+k+b.csvEnclosure;return k}function h(a,d,w){a=c(a);content_data="true"==b.htmlContent?a.html().trim():a.text().trim().replace(/\u00AD/g,
"");"true"==b.escape&&(content_data=escape(content_data));"function"===typeof b.onCellData&&(content_data=b.onCellData(a,d,w,content_data));return content_data}function x(b,a,c){return a+"-"+c.toLowerCase()}function r(b,a,c){window.getComputedStyle?(a=a.replace(/([a-z])([A-Z])/,x),a=window.getComputedStyle(b,null).getPropertyValue(a)):a=b.currentStyle?b.currentStyle[a]:b.style[a];a=a.match(/\d+/);if(null!==a){a=a[0];var d=document.createElement("div");d.style.overflow="hidden";d.style.visibility=
"hidden";b.parentElement.appendChild(d);d.style.width=100+c;c=100/d.offsetWidth;b.parentElement.removeChild(d);return a*c}return 0}function l(b,a){var c=document.createElement("a");if(c){document.body.appendChild(c);c.style="display: none";c.download=b;c.href=a;if(document.createEvent)null==n&&(n=document.createEvent("MouseEvents")),n.initEvent("click",!0,!1),c.dispatchEvent(n);else if(document.createEventObject)c.fireEvent("onclick");else if("function"==typeof c.onclick)c.onclick();document.body.removeChild(c)}}
function m(b){var a="",c,d,e,f,g,h,l=0;b=b.replace(/\x0d\x0a/g,"\n");d="";for(e=0;e<b.length;e++)f=b.charCodeAt(e),128>f?d+=String.fromCharCode(f):(127<f&&2048>f?d+=String.fromCharCode(f>>6|192):(d+=String.fromCharCode(f>>12|224),d+=String.fromCharCode(f>>6&63|128)),d+=String.fromCharCode(f&63|128));for(b=d;l<b.length;)c=b.charCodeAt(l++),d=b.charCodeAt(l++),e=b.charCodeAt(l++),f=c>>2,c=(c&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63,isNaN(d)?g=h=64:isNaN(e)&&(h=64),a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);return a}var b={csvSeparator:",",csvEnclosure:'"',onCellData:null,ignoreColumn:[],displayTableName:"false",theadSelector:"tr",tbodySelector:"tr",tableName:"myTableName",worksheetName:"xlsWorksheetName",type:"csv",dpi:0,pdfLeftMargin:20,escape:"false",htmlContent:"false",
consoleLog:"false",outputMode:"file",fileName:"tableExport",excelstyles:["border-bottom","border-top","border-left","border-right"]};a=c.extend(!0,b,a);var n=null;if("csv"==b.type||"txt"==b.type){var d="",f=0;c(this).find("thead").find(b.theadSelector).each(function(){d+="\n";c(this).filter(":visible").find("th").each(function(a,e){"none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&(d+=q(this,f,a)+b.csvSeparator)});f++;d=c.trim(d);d=c.trim(d).substring(0,
d.length-1)});c(this).find("tbody").find(b.tbodySelector).each(function(){d+="\n";c(this).filter(":visible").find("td").each(function(a,e){"none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&(d+=q(this,f,a)+b.csvSeparator)});f++;d=c.trim(d).substring(0,d.length-1)});"true"==b.consoleLog&&console.log(d);if("string"==b.outputMode)return d;if("base64"==b.outputMode)return m(d);l(b.fileName+"."+b.type,"data:text/csv;charset=utf-8,"+("csv"==b.type?
"\ufeff":"")+encodeURIComponent(d))}else if("sql"==b.type){f=0;d="INSERT INTO `"+b.tableName+"` (";c(this).find("thead").find(b.theadSelector).each(function(){c(this).filter(":visible").find("th").each(function(a,e){"none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&(d+="'"+h(this,f,a)+"',")});f++;d=c.trim(d);d=c.trim(d).substring(0,d.length-1)});d+=") VALUES ";c(this).find("tbody").find(b.tbodySelector).each(function(){d+="(";c(this).filter(":visible").find("td").each(function(a,
e){"none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)&&(d+="'"+h(this,f,a)+"',")});f++;d=c.trim(d).substring(0,d.length-1);d+="),"});d=c.trim(d).substring(0,d.length-1);d+=";";"true"==b.consoleLog&&console.log(d);if("string"==b.outputMode)return d;if("base64"==b.outputMode)return m(d);l(b.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(d))}else if("json"==b.type){var t=[];c(this).find("thead").find(b.theadSelector).each(function(){var a=
[],d=0;c(this).filter(":visible").find("th").each(function(e,f){"none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(e)&&a.push(h(this,d,e))});d++;t.push(a)});var u=[];c(this).find("tbody").find(b.tbodySelector).each(function(){var a=[];c(this).filter(":visible").find("td").each(function(d,e){"none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(d)&&a.push(h(this,f,d))});f++;u.push(a)});a=[];a.push({header:t,
data:u});"true"==b.consoleLog&&console.log(JSON.stringify(a));if("string"==b.outputMode)return JSON.stringify(a);a=m(JSON.stringify(a));if("base64"==b.outputMode)return a;l(b.fileName+".json","data:application/json;charset=utf-8;base64,"+a)}else if("xml"==b.type){var f=0,g='<?xml version="1.0" encoding="utf-8"?>',g=g+"<tabledata><fields>";c(this).find("thead").find(b.theadSelector).each(function(){c(this).filter(":visible").find("th").each(function(a,d){"none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&
-1==b.ignoreColumn.indexOf(a)&&(g+="<field>"+h(this,f,a)+"</field>")});f++});var g=g+"</fields><data>",p=1;c(this).find("tbody").find(b.tbodySelector).each(function(){g+='<row id="'+p+'">';var a=0;c(this).filter(":visible").find("td").each(function(d,e){"none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(d)&&(g+="<column-"+a+">"+h(this,f,d)+"</column-"+a+">");a++});p++;f++;g+="</row>"});g+="</data></tabledata>";"true"==b.consoleLog&&console.log(g);
if("string"==b.outputMode)return g;a=m(g);if("base64"==b.outputMode)return a;l(b.fileName+".xml","data:application/xml;charset=utf-8;base64,"+a)}else if("excel"==b.type||"doc"==b.type){var f=0,e="<table>";c(this).find("thead").find(b.theadSelector).each(function(){e+="<tr>";c(this).filter(":visible").find("th,td").each(function(a,d){if("none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(a)){e+="<td style='";for(var g in b.excelstyles)b.excelstyles.hasOwnProperty(g)&&
(e+=b.excelstyles[g]+": "+c(this).css(b.excelstyles[g])+";");e+="'>"+h(this,f,a)+"</td>"}});f++;e+="</tr>"});p=1;c(this).find("tbody").find(b.tbodySelector).each(function(){e+="<tr>";var a=0;c(this).filter(":visible").find("td").each(function(d,g){if("none"!=c(this).css("display")&&"none"!=c(this).data("tableexport-display")&&-1==b.ignoreColumn.indexOf(d)){e+="<td style='";for(var k in b.excelstyles)b.excelstyles.hasOwnProperty(k)&&(e+=b.excelstyles[k]+": "+c(this).css(b.excelstyles[k])+";");e+="'>"+
h(this,f,d)+"</td>"}a++});p++;f++;e+="</tr>"});b.displayTableName&&(e+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+h(c("<p>"+b.tableName+"</p>"))+"</td></tr>");e+="</table>";"true"==b.consoleLog&&console.log(e);a="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+b.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";a+='<meta http-equiv="content-type" content="application/vnd.ms-'+b.type+'; charset=UTF-8">';a+="<head>";"excel"==b.type&&(a+="\x3c!--[if gte mso 9]><xml>",
a+="<x:ExcelWorkbook>",a+="<x:ExcelWorksheets>",a+="<x:ExcelWorksheet>",a+="<x:Name>",a+=b.worksheetName,a+="</x:Name>",a+="<x:WorksheetOptions>",a+="<x:DisplayGridlines/>",a+="</x:WorksheetOptions>",a+="</x:ExcelWorksheet>",a+="</x:ExcelWorksheets>",a+="</x:ExcelWorkbook>",a+="</xml>",a+="<![endif]--\x3e");a+="</head>";a+="<body>";a+=e;a+="</body>";a+="</html>";if("string"==b.outputMode)return a;a=m(a);if("base64"==b.outputMode)return a;l(b.fileName+"."+("excel"==b.type?"xls":"doc"),"data:application/vnd.ms-"+
b.type+";base64,"+a)}else if("png"==b.type)html2canvas(c(this),{onrendered:function(a){a=a.toDataURL("image/png");window.open(a)}});else if("pdf"==b.type){var v=new jsPDF;a={dim:{w:r(c(this).get(0),"width","mm"),h:r(c(this).get(0),"height","mm")}};v.addHTML(c(this),b.pdfLeftMargin,0,a,function(){v.output("dataurlnewwindow")})}}})})(jQuery);
