(function(d){d.fn.extend({tableExport:function(n){function q(l,g,h,e){d(l).filter(":visible").find(g).each(function(l){if("none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==a.ignoreColumn.indexOf(l)&&"function"===typeof e){var g=0;if("undefined"!=typeof w[h]&&0<w[h].length)for(c=0;c<=l;c++)"undefined"!=typeof w[h][c]&&(e(null,h,c),delete w[h][c],l++);e(this,h,l);if(d(this).is("[colspan]"))for(g=d(this).attr("colspan"),c=0;c<g-1;c++)e(null,h,l+c);if(d(this).is("[rowspan]")){var b=
parseInt(d(this).attr("rowspan"));for(r=1;r<b;r++)for("undefined"==typeof w[h+r]&&(w[h+r]=[]),w[h+r][l]="",c=1;c<g;c++)w[h+r][l+c]=""}}})}function G(l){!0===a.consoleLog&&console.log(l.output());if("string"==a.outputMode)return l.output();if("base64"==a.outputMode)return x(l.output());try{var g=l.output("blob");saveAs(g,a.fileName+".pdf")}catch(h){y(a.fileName+".pdf","data:application/pdf;base64,"+x(l.output()))}}function H(l,g,h){var e="";if(null!=l)if(g=t(l,g,h),l=null===g||""==g?"":g.toString(),
g instanceof Date)e=a.csvEnclosure+g.toLocaleString()+a.csvEnclosure;else if(g=a.csvEnclosure+a.csvEnclosure,e=l.replace(new RegExp(a.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),g),0<=e.indexOf(a.csvSeparator)||/[\r\n ]/g.test(e))e=a.csvEnclosure+e+a.csvEnclosure;return e}function t(l,g,h){var e="";null!=l&&(l=d(l),e=!0===a.htmlContent?l.html().trim():l.text().trim().replace(/\u00AD/g,""),!0===a.escape&&(e=escape(e)),"function"===typeof a.onCellData&&(e=a.onCellData(l,g,h,e)));
return e}function M(a,g,h){return g+"-"+h.toLowerCase()}function E(a,g,h){window.getComputedStyle?(g=g.replace(/([a-z])([A-Z])/,M),g=window.getComputedStyle(a,null).getPropertyValue(g)):g=a.currentStyle?a.currentStyle[g]:a.style[g];g=g.match(/\d+/);if(null!==g){g=g[0];var e=document.createElement("div");e.style.overflow="hidden";e.style.visibility="hidden";a.parentElement.appendChild(e);e.style.width=100+h;h=100/e.offsetWidth;a.parentElement.removeChild(e);return g*h}return 0}function y(a,g){var h=
document.createElement("a");if(h){document.body.appendChild(h);h.style="display: none";h.download=a;h.href=g;if(document.createEvent)null==A&&(A=document.createEvent("MouseEvents")),A.initEvent("click",!0,!1),h.dispatchEvent(A);else if(document.createEventObject)h.fireEvent("onclick");else if("function"==typeof h.onclick)h.onclick();document.body.removeChild(h)}}function x(a){var g="",h,e,b,d,f,k,m=0;a=a.replace(/\x0d\x0a/g,"\n");e="";for(b=0;b<a.length;b++)d=a.charCodeAt(b),128>d?e+=String.fromCharCode(d):
(127<d&&2048>d?e+=String.fromCharCode(d>>6|192):(e+=String.fromCharCode(d>>12|224),e+=String.fromCharCode(d>>6&63|128)),e+=String.fromCharCode(d&63|128));for(a=e;m<a.length;)h=a.charCodeAt(m++),e=a.charCodeAt(m++),b=a.charCodeAt(m++),d=h>>2,h=(h&3)<<4|e>>4,f=(e&15)<<2|b>>6,k=b&63,isNaN(e)?f=k=64:isNaN(b)&&(k=64),g=g+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return g}var a={csvSeparator:",",csvEnclosure:'"',consoleLog:!1,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8,tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},
onCellData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"};n=d.extend(!0,a,n);var A=null,w=[];if("csv"==a.type||"txt"==a.type){var f="",m=0;d(this).find("thead").first().find(a.theadSelector).each(function(){f+="\n";q(this,"th,td",m,function(l,g,b){f+=H(l,g,b)+a.csvSeparator});m++;f=d.trim(f);f=d.trim(f).substring(0,f.length-1)});d(this).find("tbody").first().find(a.tbodySelector).each(function(){trData="";q(this,"td",
m,function(l,g,b){trData+=H(l,g,b)+a.csvSeparator});trData.length>a.csvSeparator.length&&(f+="\n"+trData);m++;f=d.trim(f).substring(0,f.length-1)});f+="\n";!0===a.consoleLog&&console.log(f);if("string"==a.outputMode)return f;if("base64"==a.outputMode)return x(f);try{var v=new Blob([("csv"==a.type?"\ufeff":"")+f],{type:"text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8"});saveAs(v,a.fileName+"."+a.type)}catch(N){y(a.fileName+"."+a.type,"data:text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8,"+
("csv"==a.type?"\ufeff":"")+encodeURIComponent(f))}}else if("sql"==a.type){m=0;f="INSERT INTO `"+a.tableName+"` (";d(this).find("thead").first().find(a.theadSelector).each(function(){q(this,"th,td",m,function(a,g,b){f+="'"+t(a,g,b)+"',"});m++;f=d.trim(f);f=d.trim(f).substring(0,f.length-1)});f+=") VALUES ";d(this).find("tbody").first().find(a.tbodySelector).each(function(){trData="";q(this,"td",m,function(a,g,b){trData+="'"+t(a,g,b)+"',"});3<trData.length&&(f+="("+trData,f=d.trim(f).substring(0,f.length-
1),f+="),");m++});f=d.trim(f).substring(0,f.length-1);f+=";";!0===a.consoleLog&&console.log(f);if("string"==a.outputMode)return f;if("base64"==a.outputMode)return x(f);try{v=new Blob([f],{type:"text/plain;charset=utf-8"}),saveAs(v,a.fileName+".sql")}catch(O){y(a.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(f))}}else if("json"==a.type){var I=[];d(this).find("thead").first().find(a.theadSelector).each(function(){var a=[],b=0;q(this,"th,td",b,function(b,g,d){a.push(t(b,g,
d))});I.push(a);b++});var J=[];d(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=[];q(this,"td",m,function(b,d,e){a.push(t(b,d,e))});0<a.length&&(1!=a.length||""!=a[0])&&J.push(a);m++});n=[];n.push({header:I,data:J});var b=JSON.stringify(n);!0===a.consoleLog&&console.log(b);if("string"==a.outputMode)return b;n=x(b);if("base64"==a.outputMode)return n;try{v=new Blob([b],{type:"application/json;charset=utf-8"}),saveAs(v,a.fileName+".json")}catch(P){y(a.fileName+".json","data:application/json;charset=utf-8;base64,"+
n)}}else if("xml"==a.type){var m=0,p='<?xml version="1.0" encoding="utf-8"?>',p=p+"<tabledata><fields>";d(this).find("thead").first().find(a.theadSelector).each(function(){q(this,"th,td",m,function(a,b,d){p+="<field>"+t(a,b,d)+"</field>"});m++});var p=p+"</fields><data>",B=1;d(this).find("tbody").first().find(a.tbodySelector).each(function(){var a=1,b="";q(this,"td",m,function(d,e,f){b+="<column-"+a+">"+t(d,e,f)+"</column-"+a+">";a++});"<column-1></column-1>"!=b&&(p+='<row id="'+B+'">'+b+"</row>",
B++);m++});p+="</data></tabledata>";!0===a.consoleLog&&console.log(p);if("string"==a.outputMode)return p;n=x(p);if("base64"==a.outputMode)return n;try{v=new Blob([p],{type:"application/xml;charset=utf-8"}),saveAs(v,a.fileName+".xml")}catch(Q){y(a.fileName+".xml","data:application/xml;charset=utf-8;base64,"+n)}}else if("excel"==a.type||"doc"==a.type){var m=0,k="<table>";d(this).find("thead").first().find(a.theadSelector).each(function(){k+="<tr>";q(this,"th,td",m,function(b,g,f){if(null!=b){k+="<td style='";
for(var e in a.excelstyles)a.excelstyles.hasOwnProperty(e)&&(k+=a.excelstyles[e]+": "+d(b).css(a.excelstyles[e])+";");k+="'>"+t(b,g,f)+"</td>"}});m++;k+="</tr>"});B=1;d(this).find("tbody").first().find(a.tbodySelector).each(function(){k+="<tr>";q(this,"td",m,function(b,g,f){if(null!=b){k+="<td style='";for(var e in a.excelstyles)a.excelstyles.hasOwnProperty(e)&&(k+=a.excelstyles[e]+": "+d(b).css(a.excelstyles[e])+";");d(b).is("[colspan]")&&(k+="' colspan='"+d(b).attr("colspan"));d(b).is("[rowspan]")&&
(k+="' rowspan='"+d(b).attr("rowspan"));k+="'>"+t(b,g,f)+"</td>"}});B++;m++;k+="</tr>"});a.displayTableName&&(k+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+t(d("<p>"+a.tableName+"</p>"))+"</td></tr>");k+="</table>";!0===a.consoleLog&&console.log(k);b="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+a.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";b+='<meta http-equiv="content-type" content="application/vnd.ms-'+a.type+'; charset=UTF-8">';
b=b+'<meta http-equiv="content-type" content="application/'+("excel"==a.type?"vnd.ms-excel":"msword");b+='; charset=UTF-8">';b+="<head>";"excel"==a.type&&(b+="\x3c!--[if gte mso 9]>",b+="<xml>",b+="<x:ExcelWorkbook>",b+="<x:ExcelWorksheets>",b+="<x:ExcelWorksheet>",b+="<x:Name>",b+=a.worksheetName,b+="</x:Name>",b+="<x:WorksheetOptions>",b+="<x:DisplayGridlines/>",b+="</x:WorksheetOptions>",b+="</x:ExcelWorksheet>",b+="</x:ExcelWorksheets>",b+="</x:ExcelWorkbook>",b+="</xml>",b+="<![endif]--\x3e");
b+="</head>";b+="<body>";b+=k;b+="</body>";b+="</html>";if("string"==a.outputMode)return b;n=x(b);if("base64"==a.outputMode)return n;var K="excel"==a.type?"xls":"doc";try{v=new Blob([b],{type:"application/vnd.ms-"+a.type}),saveAs(v,a.fileName+"."+K)}catch(R){y(a.fileName+"."+K,"data:application/vnd.ms-"+a.type+";base64,"+n)}}else if("png"==a.type)html2canvas(d(this),{onrendered:function(b){b=b.toDataURL();b=b.substring(22);for(var d=atob(b),f=new ArrayBuffer(d.length),e=new Uint8Array(f),k=0;k<d.length;k++)e[k]=
d.charCodeAt(k);try{var m=new Blob([f],{type:"image/png"});saveAs(m,a.fileName+".png")}catch(n){y(a.fileName+".png","data:image/png;base64,"+b)}}});else if("pdf"==a.type)if(!1===a.jspdf.autotable){n={dim:{w:E(d(this).first().get(0),"width","mm"),h:E(d(this).first().get(0),"height","mm")},pagesplit:!1};var F=new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);F.addHTML(d(this).first(),a.jspdf.margins.left,a.jspdf.margins.top,n,function(){G(F)});delete F}else{var u=a.jspdf.autotable.tableExport;
if("string"===typeof a.jspdf.format&&"bestfit"==a.jspdf.format.toLowerCase()){var C={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},D="",z="",L=0;d(this).filter(":visible").each(function(){if("none"!=d(this).css("display")){var a=E(d(this).get(0),"width","pt");if(a>L){a>C.a0[0]&&(D="a0",z="l");for(var b in C)C[b][1]>a&&(D=b,z="l",C[b][0]>a&&(z="p"));L=a}}});a.jspdf.format=""==D?"a4":D;a.jspdf.orientation=""==z?"w":z}u.doc=new jsPDF(a.jspdf.orientation,
a.jspdf.unit,a.jspdf.format);d(this).filter(":visible").each(function(){if("none"!=d(this).css("display")){var b=[],f=[],h=0,e={};if("function"===typeof u.onTable&&!1===u.onTable(d(this),a))return!0;Object.keys(a.jspdf.autotable).forEach(function(b){e[b]=a.jspdf.autotable[b]});e.margins={};d.extend(!0,e.margins,a.jspdf.margins);d(this).find("thead").find(a.theadSelector).each(function(){q(this,"th,td",h,function(a,d,e){b.push(t(a,d,e))});h++});d(this).find("tbody").find(a.tbodySelector).each(function(){var a=
[];q(this,"td",h,function(b,d,e){a.push(t(b,d,e))});h++;f.push(a)});if("function"===typeof u.onBeforeAutotable)u.onBeforeAutotable(d(this),b,f,e);u.doc.autoTable(b,f,e);if("function"===typeof u.onAfterAutotable)u.onAfterAutotable(d(this),e);a.jspdf.autotable.startY=u.doc.autoTableEndPosY()+e.margins.top}});G(u.doc);delete u.doc;u.doc=null}return this}})})(jQuery);
